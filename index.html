<!DOCTYPE html>
<html>

    <head>
        <title>W3.CSS Template</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    </head>

    <body>

        <!-- Side Navigation -->
        <nav class="w3-sidebar w3-bar-block w3-card w3-animate-left w3-center" style="display:none" id="mySidebar">
            <h1 class="w3-xxxlarge w3-text-theme">Side Navigation</h1>
            <button class="w3-bar-item w3-button" onclick="w3_close()">Close <i class="fa fa-remove"></i></button>
            <a href="#" class="w3-bar-item w3-button">Link 1</a>
            <a href="#" class="w3-bar-item w3-button">Link 2</a>
            <a href="#" class="w3-bar-item w3-button">Link 3</a>
            <a href="#" class="w3-bar-item w3-button">Link 4</a>
        </nav>

        <!-- Header -->
        <header class="w3-container w3-theme w3-padding" id="myHeader">
            <i onclick="w3_open()" class="fa fa-bars w3-xlarge w3-button w3-theme"></i>
            <div class="w3-center">
                <h4>BEAUTIFUL RESPONSIVE WEB SITES</h4>
                <h1 class="w3-xxxlarge w3-animate-bottom">BUILT WITH W3.CSS</h1>
                <div class="w3-padding-32">
                    <button class="w3-btn w3-xlarge w3-dark-grey w3-hover-light-grey"
                        onclick="document.getElementById('id01').style.display='block'" style="font-weight:900;">LEARN
                        W3.CSS</button>
                </div>
            </div>
        </header>

        <!-- Modal -->
        <div id="id01" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-animate-top">
                <header class="w3-container w3-theme-l1">
                    <span onclick="document.getElementById('id01').style.display='none'"
                        class="w3-button w3-display-topright">×</span>
                    <h4>Oh snap! We just showed you a modal..</h4>
                    <h5>Because we can <i class="fa fa-smile-o"></i></h5>
                </header>
                <div class="w3-padding">
                    <p>Cool huh? Ok, enough teasing around..</p>
                    <p>Go to our <a class="w3-btn" href="/w3css/default.asp">W3.CSS Tutorial</a> to learn more!</p>
                </div>
                <footer class="w3-container w3-theme-l1">
                    <p>Modal footer</p>
                </footer>
            </div>
        </div>

        <div class="w3-row-padding w3-center w3-margin-top">
            <div class="w3-third">
                <div class="w3-card w3-container" style="min-height:460px">
                    <h3>Responsive</h3><br>
                    <i class="fa fa-desktop w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
                    <p>Built-in responsiveness</p>
                    <p>Mobile first fluid grid</p>
                    <p>Fits any screen sizes</p>
                    <p>PC Tablet and Mobile</p>
                </div>
            </div>

            <div class="w3-third">
                <div class="w3-card w3-container" style="min-height:460px">
                    <h3>Standard CSS</h3><br>
                    <i class="fa fa-css3 w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
                    <p>Standard CSS only</p>
                    <p>Easy to learn</p>
                    <p>No need for jQuery</p>
                    <p>No JavaScript library</p>
                </div>
            </div>

            <div class="w3-third">
                <div class="w3-card w3-container" style="min-height:460px">
                    <h3>Design</h3><br>
                    <i class="fa fa-diamond w3-margin-bottom w3-text-theme" style="font-size:120px"></i>
                    <p>Paper like design</p>
                    <p>Bold colors and shadows</p>
                    <p>Equal across platforms</p>
                    <p>Equal across devices</p>
                </div>
            </div>
        </div>

        <div class="w3-container">
            <hr>
            <div class="w3-center">
                <h2>Location</h2>


                <div class="w3-row">
                    <p id="location"></p>
                </div>
            </div>

            <hr>
            <h2 class="w3-center">Forms and Lists</h2>
        </div>

        <div class="w3-row-padding">

            <div class="w3-full">
                <form id="myForm" class="w3-container w3-card-4">
                    <h2>Input Form</h2>
                    <div class="w3-section">
                        <input id="name" class="w3-input" type="text" required>
                        <label><b>Name</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="personal_email" class="w3-input" type="email"
                            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required>
                        <label><b>Personal Email</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="student_email" class="w3-input" type="email"
                            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required>
                        <label><b>Student Email</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="phone_number" class="w3-input" type="text" pattern="[0-9]*" inputmode="numeric"
                            required>
                        <label><b>Phone number</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="specialisation" class="w3-input" type="text" required>
                        <label><b>Specialisation</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="formatted_address" class="w3-input" type="text" required>
                        <label><b>Formatted Address</b></label>
                    </div>
                    <div class="w3-section">
                        <input id="lat_long" class="w3-input" type="text" required>
                        <label><b>Lat & Long</b></label>
                    </div>

                    <div class="w3-row">
                        <div class="w3-full">
                            <label>
                                <input name="year_of_study" class="w3-radio" type="radio" value="3rd year">
                                3rd year
                            </label>
                            <label>
                                <input name="year_of_study" class="w3-radio" type="radio" value="Hons">
                                Hons
                            </label>
                            <label>
                                <input name="year_of_study" class="w3-radio" type="radio" value="Masters">
                                Masters
                            </label>
                            <label>
                                <input name="year_of_study" class="w3-radio" type="radio" value="Other">
                                Other
                            </label>
                            <br>
                            <label><b>Year of study</b></label>
                            <br><br>
                        </div>
                    </div>

                    <div class="w3-row">
                        <div class="w3-full">
                            <label>
                                <input name="gender" class="w3-radio" type="radio" value="Female">
                                Female
                            </label>
                            <label>
                                <input name="gender" class="w3-radio" type="radio" value="Male">
                                Male
                            </label>
                            <label>
                                <input name="gender" class="w3-radio" type="radio" value="Other">
                                Other
                            </label>
                            <br>
                            <label><b>Gender</b></label>
                            <br><br>
                        </div>
                    </div>

                    <div class="w3-row">
                        <div class="w3-full">
                            <label>
                                <input name="race" class="w3-radio" type="radio" value="African">
                                African
                            </label>
                            <label>
                                <input name="race" class="w3-radio" type="radio" value="Coloured">
                                Coloured
                            </label>
                            <label>
                                <input name="race" class="w3-radio" type="radio" value="Foreign National with PR">
                                Foreign National with PR
                            </label>
                            <label>
                                <input name="race" class="w3-radio" type="radio" value="Indian">
                                Indian
                            </label>
                            <label>
                                <input name="race" class="w3-radio" type="radio" value="White">
                                White
                            </label>
                            <br>
                            <label><b>Race</b></label>
                            <br><br>
                        </div>
                    </div>


                    <div class="w3-row">
                        <div class="w3-full">
                            <label>
                                <input name="question" class="w3-radio" type="radio" value="git new">
                                git new &lt;branch name&gt;
                            </label>
                            <label>
                                <input name="question" class="w3-radio" type="radio" value="git create branch">
                                git create branch &lt;branch name&gt;
                            </label>
                            <label>
                                <input name="question" class="w3-radio" type="radio" value="git branch">
                                git branch &lt;branch name&gt;
                            </label>
                            <br>
                            <label><b>What is the command used to create a new branch in Git?</b></label>
                            <br><br>
                        </div>
                    </div>

                    <div class="w3-row">
                        <div class="w3-full">
                            <input id="terms" name="terms" class="w3-check" type="checkbox" checked="checked"
                                value="I agree that my data might be used for recruiting purposes by BSG">
                            <label>I agree that my data might be used for recruiting purposes by BSG</label>
                            <br><br>
                        </div>
                    </div>

                    <div class="w3-section">
                        <button id="save" class=" w3-btn w3-xlarge w3-dark-grey w3-hover-light-grey"
                            style="font-weight:900;">Save</button>
                    </div>
                </form>
            </div>
        </div>
        <hr>

        <!-- Footer -->
        <footer class="w3-container w3-theme-dark w3-padding-16">
            <h3>Footer</h3>
            <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
            <div style="position:relative;bottom:55px;" class="w3-tooltip w3-right">
                <span class="w3-text w3-theme-light w3-padding">Go To Top</span> 
                <a class="w3-text-white" href="#myHeader"><span class="w3-xlarge">
                        <i class="fa fa-chevron-circle-up"></i></span></a>
            </div>
            <p>Remember to check out our  <a href="w3css_references.asp" class="w3-btn w3-theme-light"
                    target="_blank">W3.CSS Reference</a></p>
        </footer>

        <!-- Script for Sidebar, Tabs, Accordions, Progress bars and slideshows -->
        <script>
            // Side navigation
            function w3_open() {
                var x = document.getElementById("mySidebar");
                x.style.width = "100%";
                x.style.fontSize = "40px";
                x.style.paddingTop = "10%";
                x.style.display = "block";
            }
            function w3_close() {
                document.getElementById("mySidebar").style.display = "none";
            }

            // Tabs
            function openCity(evt, cityName) {
                var i;
                var x = document.getElementsByClassName("city");
                for (i = 0; i < x.length; i++) {
                    x[i].style.display = "none";
                }
                var activebtn = document.getElementsByClassName("testbtn");
                for (i = 0; i < x.length; i++) {
                    activebtn[i].className = activebtn[i].className.replace(" w3-dark-grey", "");
                }
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " w3-dark-grey";
            }

            // Accordions
            function myAccFunc(id) {
                var x = document.getElementById(id);
                if (x.className.indexOf("w3-show") == -1) {
                    x.className += " w3-show";
                } else {
                    x.className = x.className.replace(" w3-show", "");
                }
            }
        </script>

        <script>
            let el = document.getElementById("location");
            var key = 'AIzaSyBNTSWf0MqZZzoXNvi_W_3z4AbGLcP_lkE';
            function fallbackGeoLocation() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        var geolocation = JSON.parse(xhttp.responseText).location;
                        var loc = geolocation.lat + ',' + geolocation.lng;
                        el.innerHTML = '<a target="_blank" href="http://maps.google.com/maps/place/' + loc + '/@' + loc + ',10z/data=!3m1!1e3"><img style="width:100%" src=https://maps.googleapis.com/maps/api/staticmap?zoom=16&size=700x400&maptype=roadmap&markers=color:red%7Clabel:C%7C' + loc + '&key=' + key + '></a><br><br>';
                        el.innerHTML += '<b>Geo Coordinates:</b> ' + geolocation.lat + ', ' + geolocation.lng + '<br>';
                        var xhttp2 = new XMLHttpRequest();
                        xhttp2.onreadystatechange = function () {
                            if (xhttp2.readyState == 4 && xhttp2.status == 200) {
                                // console.log(xhttp2.responseText);
                                var locationName = JSON.parse(xhttp2.responseText).results;
                                var Local_Time = new Date();
                                var Location_Name = locationName[0].formatted_address;
                                //console.log(Location_Name)
                                el.innerHTML += '<b>Location Name:</b> ' + Location_Name + '<br>';
                                el.innerHTML += '<b>Local Time:</b> ' + Local_Time;
                                // NO IDEA WHY THIS IS NOT WORKING, SEEMS LIKE CHOME CHANGED SOMETHING AND NEED TO ACCESS THE ELEMENT AGAIN
                                document.getElementById("location").innerHTML = el.innerHTML
                                document.getElementById("formatted_address").value = Location_Name;
                                document.getElementById("lat_long").value = geolocation.lat + ', ' + geolocation.lng;
                            }
                        };

                        xhttp2.open("POST", 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + geolocation.lat + ',' + geolocation.lng + '&sensor=true&key=' + key, true);
                        xhttp2.send();
                    }
                    if (xhttp.readyState == 4 && (xhttp.status == 403 || xhttp.status == 500)) {
                        el.innerHTML += 'Sorry! Our Google Geolocation API Quota exceeded.';
                    }
                };

                xhttp.open("POST", "https://www.googleapis.com/geolocation/v1/geolocate?key=" + key, true);
                xhttp.send();
            }
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition, showError);
                } else {
                    el.innerHTML = "Geolocation is not supported by this browser.";
                    fallbackGeoLocation();
                }
            }
            function showPosition(position) {
                var loc = position.coords.latitude + ',' + position.coords.longitude;
                // console.log(el);
                el.innerHTML = '<a target="_blank" href="http://maps.google.com/maps/place/' + loc + '/@' + loc + ',10z/data=!3m1!1e3"><img style="width:100%" src=https://maps.googleapis.com/maps/api/staticmap?zoom=16&size=700x400&maptype=roadmap&markers=color:red%7Clabel:C%7C' + loc + '&key=' + key + ' ></a><br><br>';
                el.innerHTML += '<b>Geo Coordinates:</b> ' + position.coords.latitude + ', ' + position.coords.longitude + '<br>';
                var xhttp3 = new XMLHttpRequest();
                xhttp3.onreadystatechange = function () {
                    if (xhttp3.readyState == 4 && xhttp3.status == 200) {
                        var locationName = JSON.parse(xhttp3.responseText).results;
                        var Local_Time = new Date();
                        var Location_Name = locationName[0].formatted_address;
                        el.innerHTML += '<b>Location Name:</b> ' + Location_Name + '<br>';
                        el.innerHTML += '<b>Local Time:</b> ' + Local_Time;
                        // NO IDEA WHY THIS IS NOT WORKING, SEEMS LIKE CHOME CHANGED SOMETHING AND NEED TO ACCESS THE ELEMENT AGAIN
                        document.getElementById("location").innerHTML = el.innerHTML
                        document.getElementById("formatted_address").value = Location_Name;
                        document.getElementById("lat_long").value = position.coords.latitude + ', ' + position.coords.longitude;
                    }
                };
                xhttp3.open("POST", 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + position.coords.latitude + ',' + position.coords.longitude + '&sensor=true&key=' + key, true);
                xhttp3.send();
            }
            function showError(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        el.innerHTML = "User denied the request for Geolocation.";
                        fallbackGeoLocation();
                        break;
                    case error.POSITION_UNAVAILABLE:
                        el.innerHTML = "Location information is unavailable."
                        fallbackGeoLocation();
                        break;
                    case error.TIMEOUT:
                        el.innerHTML = "The request to get user location timed out."
                        fallbackGeoLocation();
                        break;
                    case error.UNKNOWN_ERROR:
                        el.innerHTML = "An unknown error occurred."
                        fallbackGeoLocation();
                        break;
                }
            }
            getLocation();

            function isValidEmail(email) {
                console.log(email)
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                console.log(emailRegex.test(email))
                return emailRegex.test(email);
            }

            function isValidPhoneNumber(phoneNumber) {
                console.log(phoneNumber)
                const phoneRegex = /^\d{10}$/;
                console.log(phoneRegex.test(phoneNumber))
                return phoneRegex.test(phoneNumber);
            }

            function validateForm() {
                var requiredInputs = document.querySelectorAll('.w3-input[required]');
                var isValid = true;

                requiredInputs.forEach(function (input) {
                    if (input.value.trim() === '') {
                        input.classList.add('w3-border-red');
                        isValid = false;
                    } else {
                        input.classList.remove('w3-border-red');
                    }
                });

                var checkedPersonal_email = document.getElementById('personal_email').value;
                if (!isValidEmail(checkedPersonal_email)) {
                    document.getElementById('personal_email').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.getElementById('personal_email').classList.remove('w3-border-red');
                }

                var checkedStudent_email = document.getElementById('student_email').value;
                if (!isValidEmail(checkedStudent_email)) {
                    document.getElementById('student_email').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.getElementById('student_email').classList.remove('w3-border-red');
                }

                var checkedPhone_number = document.getElementById('phone_number').value;
                if (!isValidPhoneNumber(checkedPhone_number)) {
                    document.getElementById('phone_number').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.getElementById('phone_number').classList.remove('w3-border-red');
                }

                var checkedGender = document.querySelector('input[name="gender"]:checked');
                if (!checkedGender) {
                    document.querySelector('input[name="gender"]').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.querySelector('input[name="gender"]').classList.remove('w3-border-red');
                }

                var checkedRace = document.querySelector('input[name="race"]:checked');
                if (!checkedRace) {
                    document.querySelector('input[name="race"]').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.querySelector('input[name="race"]').classList.remove('w3-border-red');
                }

                var checkedYear_of_study = document.querySelector('input[name="year_of_study"]:checked');
                if (!checkedYear_of_study) {
                    document.querySelector('input[name="year_of_study"]').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.querySelector('input[name="year_of_study"]').classList.remove('w3-border-red');
                }

                var checkedQuestion = document.querySelector('input[name="question"]:checked');
                if (!checkedQuestion) {
                    document.querySelector('input[name="question"]').classList.add('w3-border-red');
                    isValid = false;
                } else {
                    document.querySelector('input[name="question"]').classList.remove('w3-border-red');
                }
                return isValid;
            }

            function clearForm() {
                const form = document.querySelector('#myForm');
                form.reset();
            }

            function save_record() {

                if (!validateForm()) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Get input values
                var name = document.getElementById('name').value;
                var personal_email = document.getElementById('personal_email').value;
                var student_email = document.getElementById('student_email').value;
                var phone_number = document.getElementById('phone_number').value;
                var specialisation = document.getElementById('specialisation').value;
                var year_of_study = document.querySelector('input[name="year_of_study"]:checked').value;
                var formatted_address = document.getElementById('formatted_address').value;
                var latLong = document.getElementById('lat_long').value;
                var gender = document.querySelector('input[name="gender"]:checked').value;
                var race = document.querySelector('input[name="race"]:checked').value;
                var question = document.querySelector('input[name="question"]:checked').value;
                var terms = document.querySelector('input[name="terms"]:checked').value;

                // Create data object
                var data = {
                    "name": name,
                    "personal_email": personal_email,
                    "student_email": student_email,
                    "phone_number": phone_number,
                    "specialisation": specialisation,
                    "year_of_study": year_of_study,
                    "formatted_address": formatted_address,
                    "lat_long": latLong,
                    "gender": gender,
                    "race": race,
                    "question": question,
                    "terms": terms
                };

                var xhttp4 = new XMLHttpRequest();
                xhttp4.onreadystatechange = function () {
                    if (xhttp4.readyState == 4 && xhttp4.status == 200) {
                        console.log(xhttp4.responseText)
                    }
                };

                xhttp4.open("POST", 'https://x8ki-letl-twmt.n7.xano.io/api:nOx5VOGn/ukzn_student_login', true);
                xhttp4.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

                xhttp4.send(JSON.stringify(data));
                clearForm();
                location.reload();
            }

            document.getElementById("save").addEventListener("click", function (event) {
                event.preventDefault(); // Prevent form submission
                save_record();
            });
        </script>

    </body>

</html>
